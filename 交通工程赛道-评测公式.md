# 交通工程赛道-评测公式

## 第一部分：性能得分 $S_{perf}$ 详解

### 1. 通行效率得分 $S_{efficiency}$

效率由 OD 完成率（OD Completion Rate, OCR）这一个指标体现。

#### 1.1 OD 完成率 (OCR)
衡量所有车辆 OD 任务的整体完成程度。

**计算方法：**

$$ OCR = \frac{N_{arrived} + \sum_{i \in V_{enroute}} \frac{d_{i}^{traveled}}{d_{i}^{total}}}{N_{total}} $$

**其中：**
*   **$N_{arrived}$**: 已成功到达目的地的车辆数。
*   **$V_{enroute}$**: 仿真结束时仍在途的车辆集合。
*   **$d_{i}^{traveled}$**: 在途车辆 $i$ 已行驶的距离。
*   **$d_{i}^{total}$**: 在途车辆 $i$ 需要行驶的总距离（OD 路径总长）。
*   **$N_{total}$**: 总车辆数。

#### 1.2 通行量相对增益
$$ \Delta OCR = \frac{OCR_{AI} - OCR_{Base}}{OCR_{Base}} $$

**其中：**
*   **$Base$**: 仿真场景的基准方案。
*   **$AI$**: 选手提供的智能方案。

#### 1.3 效率得分计算
$$ S_{efficiency} = 100 \times [\max(0, \Delta OCR)] $$

---

### 2. 交通流稳定性得分 $S_{stability}$

稳定性衡量交通流的平顺程度，避免速度剧烈波动。

*   **速度标准差 ($\sigma_v$)**: 所有车辆在所有时间步的速度值的标准差，值越小越稳定。
*   **平均绝对加速度 ($|a|_{avg}$)**: 所有车辆在所有时间步的加速度绝对值的平均值，值越小表示加减速越平缓，驾驶体验和能耗更优。

#### 2.1 计算方法

**速度标准差相对改善 ($I_{\sigma_v}$):**
$$ I_{\sigma_v} = -\frac{\sigma_v^{AI} - \sigma_v^{Base}}{\sigma_v^{Base}} $$

**平均绝对加速度相对改善 ($I_{|a|_{avg}}$):**
$$ I_{|a|_{avg}} = -\frac{|a|_{avg}^{AI} - |a|_{avg}^{Base}}{|a|_{avg}^{Base}} $$

#### 2.2 稳定性得分计算
$$ S_{stability} = 100 \times [w_{\sigma_v} \cdot \max(0, I_{\sigma_v}) + w_{|a|_{avg}} \cdot \max(0, I_{|a|_{avg}})] $$

**权重:**
*   $w_{\sigma_v} = 0.4$
*   $w_{|a|_{avg}} = 0.6$

*注：速度波动是稳定性的核心体现，权重稍高。*

---

## 第二部分：干预成本惩罚因子 $P_{int}$ 详解

这个因子体现了“以最小的干预成本”这一核心理念。

### 1. 干预成本 $C_{int}$ 的构成

干预成本分为两个阶段，复赛阶段是初赛阶段的扩展。

#### 1.1 初赛阶段 (仅控制智能体车辆)

$$ C_{int} = C_{ICV} $$

$$ C_{ICV} = \frac{1}{T_{total} \cdot N_{ICV}} \sum_{t=1}^{T_{total}} \sum_{i=1}^{N_{ICV}} (\alpha \cdot acmd_{,i}(t) + \beta \cdot \delta lc_{,i}(t)) $$

**说明:**
*   **$N_{ICV}$**: 场景中智能网联车的数量。
*   **$T_{total}$**: 总仿真步长。
*   **$acmd_{,i}(t)$**: 一个指示函数，如果 AI 在 $t$ 时刻对第 $i$ 辆 ICV 下达的加速度/减速度指令则为 1，否则为 0。
*   **$\delta lc_{,i}(t)$**: 一个指示函数，如果 AI 在 $t$ 时刻向第 $i$ 辆 ICV 下达了换道指令则为 1，否则为 0。
*   **$\alpha, \beta$**: 权重系数，用于平衡加速度控制和换道控制的成本。$\alpha = 1, \beta = 5$（换道被认为是一个成本更高的决策）。

#### 1.2 复赛阶段 (控制车辆+设施)

$$ C_{int} = C_{ICV} + C_{Infra} $$

$$ C_{Infra} = \frac{1}{T}(\gamma \cdot NVSL\_change + \eta \cdot NSignal\_change) $$

**说明:**
*   **$C_{ICV}$**: 同初赛阶段计算公式一样。
*   **$NVSL\_change$**: 仿真期间，可变限速（VSL）标志数值发生改变的总次数。
*   **$NSignal\_change$**: 仿真期间，匝道信号灯相位配置方案发生改变的总次数。
*   **$\gamma, \eta$**: 权重系数，用于平衡不同设施的控制成本。

### 2. 惩罚因子 $P_{int}$ 的计算

我们使用一个指数衰减函数来计算惩罚因子，使得干预成本越高，惩罚越严厉。

$$ P_{int} = e^{-k \cdot C_{int}} $$

**说明:**
*   **$k$**: 惩罚系数，是一个需要根据测试数据标定的超参数。它的作用是调节惩罚的严厉程度。$k$ 值越大，对干预成本的惩罚越重。

---

## 最终得分汇总与权重详解

### 最终总分 $S_{total}$

$$ S_{total} = (W_{efficiency} * S_{efficiency} + W_{stability} * S_{stability}) \times e^{-k \cdot C_{int}} $$
